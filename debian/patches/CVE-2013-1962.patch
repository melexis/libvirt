From ca697e90d5bd6a6dfb94bfb6d4438bdf9a44b739 Mon Sep 17 00:00:00 2001
From: =?utf8?q?J=C3=A1n=20Tomko?= <jtomko@redhat.com>
Date: Fri, 12 Apr 2013 17:30:56 +0200
Subject: [PATCH] daemon: fix leak after listing all volumes

CVE-2013-1962

remoteDispatchStoragePoolListAllVolumes wasn't freeing the pool.
The pool also held a reference to the connection, preventing it from
getting freed and closing the netcf interface driver, which held two
sockets open.
---
 daemon/remote.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

Index: libvirt-1.0.2/daemon/remote.c
===================================================================
--- libvirt-1.0.2.orig/daemon/remote.c	2013-06-28 13:01:21.025220061 -0400
+++ libvirt-1.0.2/daemon/remote.c	2013-06-28 13:01:21.017220062 -0400
@@ -4233,6 +4233,8 @@
             virStorageVolFree(vols[i]);
         VIR_FREE(vols);
     }
+    if (pool)
+        virStoragePoolFree(pool);
     return rv;
 }
 
